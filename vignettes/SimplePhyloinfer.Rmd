---
title: "Simple BNPR/MCMC Vignette"
author: "Michael Karcher"
date: "April 2, 2015"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Simple BNPR/MCMC Vignette}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

This vignette shows a simple and typical use of `phylodyn` and its MCMC tools. We start by loading the `phylodyn` package.

```{r message=FALSE, echo=-1}
set.seed(8675309)
library(phylodyn)
```

We need to set the true effective population size trajectory function, and also its reciprocal. For this example, we choose exponential growth (already implemented in `phylodyn`).

```{r}
traj_inv = exp_traj_inv
```

For simplicity's sake, we will use isochronous sampling (taking all samples simultaneously at t=0). We sample 100 individuals at the present time.

```{r}
samp_times = 0
n_sampled  = 100
```

We simulate a genealogy based on our sample using the coalescent.

```{r}
sample = cbind(n_sampled, samp_times)
gene = coalgen_thinning_hetero(sample = sample, traj_inv = traj_inv, 5)
```

We first use BNPR to calculate approximate marginals. We use a helper function to generate the arguments for the BNPR function.

```{r}
res_BNPR = BNPR(data = gene, lengthout = 100)
```

We set the number of samples and burn-in parameters. For expediency in this vignette we set them to be small. To produce more meaningful results, increase both parameters.

```{r}
nsamp = 500
nburnin = 100
```

We invoke the `mcmc_sampling` function with `splitHMC` to run MCMC on the data.

```{r results='hide'}
res_MCMC = mcmc_sampling(data = gene, alg = 'splitHMC', nsamp = nsamp,
                         nburnin = nburnin)
```

We plot and compare the results from BNPR and splitHMC.

```{r fig.width=5, fig.height=5}
# Plot the results of BNPR
plot_BNPR(BNPR_out = res_BNPR,traj = traj)
title("Exponential growth")
  
# plot the results of splitHMC
lines(res_MCMC$med_fun, pch="", col='red', lwd=2.5)
lines(res_MCMC$low_fun, pch="", col='red', lwd=2, lty=3)
lines(res_MCMC$up_fun,  pch="", col='red', lwd=2, lty=3)
legend('topright',c('Truth','BNPR',"splitHMC"),
       col=c('black','blue','red'),lwd=c(1,2.5,2.5),bty='n')
```
